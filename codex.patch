diff --git a/last_change.diff b/last_change.diff
new file mode 100644
index 0000000000000000000000000000000000000000..7fd9efaa2d6a27fdc7f02da95b4d6475a9616836
--- /dev/null
+++ b/last_change.diff
@@ -0,0 +1,341 @@
+commit 5c495a97f6139d202a770b28358a0554f1333596
+Author: Codex <codex@openai.com>
+Date:   Sun Nov 30 14:41:54 2025 +0000
+
+    Handle extended pullback streaks before reversal
+    
+    ## Summary
+    - allow the pullback detector to accept three or more consecutive down-day streaks after a recent high before requiring a reversal
+    - gate entries on breaking yesterday's high plus buffer, not just a fixed three-day window
+    - document the updated "3+ day decline then reversal" requirement in STRATEGY_CHANGE.md
+    
+    ## Testing
+    - python -m compileall trader
+
+diff --git a/trader/STRATEGY_CHANGE.md b/trader/STRATEGY_CHANGE.md
+new file mode 100644
+index 0000000..8948560
+--- /dev/null
++++ b/trader/STRATEGY_CHANGE.md
+@@ -0,0 +1,17 @@
++# Pullback Reversal Dip Strategy Update
++
++ì´ì „ ëˆŒë¦¼ëª© ë¡œì§(ì§„ì… í›„ ê³ ì  ëŒ€ë¹„ -1.5%/-3.0% ë¶„í• ë§¤ìˆ˜)ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
++
++## í•µì‹¬ ë³€í™”
++- **íŒ¨í„´ í•„ìˆ˜ ì§„ì… ì¡°ê±´**: ì‹ ê³ ê°€(ìµœê·¼ `PULLBACK_LOOKBACK`ì¼ ë‚´ ìµœê³ ê°€) ë‹¬ì„± í›„ `PULLBACK_DAYS`ì¼ ì´ìƒ ì—°ì† í•˜ë½í•œ ìƒíƒœì—ì„œ ì–´ì œ ê³ ê°€ë¥¼ ëŒíŒŒ(ë°˜ë“±)í•˜ë ¤ëŠ” íë¦„ì´ í™•ì¸ë¼ì•¼ ì‹ ê·œ ì§„ì…/ì¶”ê°€ ë§¤ìˆ˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‹ í˜¸ ë¯¸ì¶©ì¡± ì‹œ ëŒíŒŒÂ·ëˆŒë¦¼ ëª¨ë‘ ìŠ¤í‚µí•©ë‹ˆë‹¤.
++- **ë°˜ë“± í™•ì¸ ê°€ê²©**: ì–´ì œ(ë§ˆì§€ë§‰ í•˜ë½ì¼) ê³ ê°€ì— `PULLBACK_REVERSAL_BUFFER_PCT`(ê¸°ë³¸ 0.2%)ë¥¼ ë”í•œ ê°€ê²©ì„ ë˜ëŒë¦¼ ê¸°ì¤€ì„ ìœ¼ë¡œ ì‚¬ìš©í•˜ë©°, ì´ ê°€ê²©ì„ íšŒë³µí•´ì•¼ â€œreversingâ€ìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
++- **ìƒíƒœ ì €ì¥**: íŒ¨í„´ íƒì§€ ê²°ê³¼ë¥¼ í¬ì§€ì…˜ ìƒíƒœ(`pullback_peak_price`, `pullback_reversal_price`, `pullback_reason`)ì— ê¸°ë¡í•´ ì¥ì¤‘ ì¬í‰ê°€ì™€ ë¦¬í¬íŠ¸ì— í™œìš©í•©ë‹ˆë‹¤.
++
++## ì½”ë“œ ì ìš© ìœ„ì¹˜
++- `CONFIG`ì— ìƒˆ íŒŒë¼ë¯¸í„°(`USE_PULLBACK_ENTRY`, `PULLBACK_LOOKBACK`, `PULLBACK_DAYS`, `PULLBACK_REVERSAL_BUFFER_PCT`)ë¥¼ ì¶”ê°€í•´ `.env`ë¡œ ì¡°ì • ê°€ëŠ¥í•˜ê²Œ í–ˆìŠµë‹ˆë‹¤.
++- `_detect_pullback_reversal` í•¨ìˆ˜ê°€ ì¼ë´‰ì„ ìŠ¤ìº”í•´ â€œì‹ ê³ ê°€ â†’ 3ì¼ í•˜ë½ â†’ ë°˜ë“±â€ íŒ¨í„´ì„ ì°¾ì•„ `setup/reversing/reversal_price/peak_price` ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
++- ì§„ì… ë£¨í”„ì™€ ì¶”ê°€ ë§¤ìˆ˜ ë¡œì§ì—ì„œ `USE_PULLBACK_ENTRY`ê°€ ì¼œì ¸ ìˆìœ¼ë©´ ìœ„ íŒ¨í„´ì´ ì„±ë¦½(`setup` & `reversing`)í•´ì•¼ë§Œ ì£¼ë¬¸ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
++
++## ê¸°ëŒ€ íš¨ê³¼
++- ë‹¨ìˆœ intraday í•˜ë½í­ ê¸°ë°˜ ë¬¼íƒ€ê¸° ëŒ€ì‹ , ì¶”ì„¸ ê³ ì  ì´í›„ ì •ìƒ ì¡°ì •Â·ë°˜ë“± êµ¬ê°„ì— í•œì •í•´ ì§„ì…í•˜ë„ë¡ ì œí•œí•˜ì—¬ ì˜ë¯¸ ì—†ëŠ” ì¶”ë½ êµ¬ê°„ ë¬¼íƒ€ê¸°ë¥¼ ì¤„ì…ë‹ˆë‹¤.
++- íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ í•˜ë½ ì¼ìˆ˜Â·ë°˜ë“± ì—¬ìœ í­ì„ ì†ì‰½ê²Œ íŠœë‹í•  ìˆ˜ ìˆì–´ ì‹œì¥ í™˜ê²½ì— ë§ì¶˜ ë³´ìˆ˜/ê³µê²©ì  ìš´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
+diff --git a/trader/trader.py b/trader/trader.py
+index 6a8ced8..5322d4b 100644
+--- a/trader/trader.py
++++ b/trader/trader.py
+@@ -59,6 +59,11 @@ CONFIG = {
+     "TRAIL_PCT_BULL": "0.025",
+     "TRAIL_PCT_BEAR": "0.012",
+     "TP_PROFIT_PCT_BULL": "3.5",
++    # ì‹ ê³ ê°€ ëŒíŒŒ í›„ 3ì¼ ëˆŒë¦¼ + ë°˜ë“± ë§¤ìˆ˜ìš© íŒŒë¼ë¯¸í„°
++    "USE_PULLBACK_ENTRY": "true",          # trueë©´ 'ì‹ ê³ ê°€ â†’ 3ì¼ ì—°ì† í•˜ë½ â†’ ë°˜ë“±' íŒ¨í„´ ì¶©ì¡± ì‹œì—ë§Œ ëˆŒë¦¼ëª© ì§„ì… í—ˆìš©
++    "PULLBACK_LOOKBACK": "60",             # ì‹ ê³ ê°€ íƒìƒ‰ ë²”ìœ„(ê±°ë˜ì¼ ê¸°ì¤€)
++    "PULLBACK_DAYS": "3",                  # ì—°ì† í•˜ë½ ì¼ìˆ˜
++    "PULLBACK_REVERSAL_BUFFER_PCT": "0.2", # ë˜ëŒë¦¼ í™•ì¸ ì—¬ìœ (%): ì§ì „ í•˜ë½ì¼ ê³ ê°€ ëŒ€ë¹„ ì—¬ìœ ìœ¨
+     # ê¸°íƒ€
+     "MARKET_DATA_WHEN_CLOSED": "false",
+     "FORCE_WEEKLY_REBALANCE": "0",
+@@ -161,6 +166,11 @@ MOMENTUM_OVERRIDES_FORCE_SELL = _cfg("MOMENTUM_OVERRIDES_FORCE_SELL").lower() ==
+ MOM_FAST = int(_cfg("MOM_FAST") or "5")
+ MOM_SLOW = int(_cfg("MOM_SLOW") or "20")
+ MOM_TH_PCT = float(_cfg("MOM_TH_PCT") or "0.5")
++# ì‹ ê³ ê°€ â†’ 3ì¼ ëˆŒë¦¼ â†’ ë°˜ë“± í™•ì¸ í›„ ë§¤ìˆ˜ íŒŒë¼ë¯¸í„°
++USE_PULLBACK_ENTRY = _cfg("USE_PULLBACK_ENTRY").lower() != "false"
++PULLBACK_LOOKBACK = int(_cfg("PULLBACK_LOOKBACK") or "60")
++PULLBACK_DAYS = int(_cfg("PULLBACK_DAYS") or "3")
++PULLBACK_REVERSAL_BUFFER_PCT = float(_cfg("PULLBACK_REVERSAL_BUFFER_PCT") or "0.2")
+ 
+ def _parse_hhmm(hhmm: str) -> dtime:
+     try:
+@@ -464,6 +474,114 @@ def _get_daily_candles_cached(kis: KisAPI, code: str, count: int) -> List[Dict[s
+         _DAILY_CANDLE_CACHE[code] = {"date": today, "candles": candles}
+     return candles or []
+ 
++
++def _detect_pullback_reversal(
++    kis: KisAPI,
++    code: str,
++    current_price: Optional[float] = None,
++    lookback: int = PULLBACK_LOOKBACK,
++    pullback_days: int = PULLBACK_DAYS,
++    buffer_pct: float = PULLBACK_REVERSAL_BUFFER_PCT,
++) -> Dict[str, Any]:
++    """
++    ì‹ ê³ ê°€ ë‹¬ì„± ì´í›„ 3ì¼ ì—°ì† í•˜ë½ í›„ ë°˜ë“± ì—¬ë¶€ë¥¼ íŒì •í•œë‹¤.
++
++    ë°˜í™˜ ì˜ˆì‹œ
++    {
++        "setup": True/False,        # ì‹ ê³ ê°€ ì´í›„ 3ì¼ ì—°ì† í•˜ë½ íŒ¨í„´ ì¶©ì¡± ì—¬ë¶€
++        "reversing": True/False,    # í˜„ì¬ê°€ê°€ ë˜ëŒë¦¼ í™•ì¸ì„  ìœ„ë¡œ ëŒì•„ì„°ëŠ”ì§€
++        "reversal_price": float,    # ë˜ëŒë¦¼ í™•ì¸ì„ (ì§ì „ í•˜ë½ì¼ ê³ ê°€ Ã— (1+buffer))
++        "peak_price": float,        # ì‹ ê³ ê°€(lookback ë‚´ ìµœê³ ê°€)
++        "peak_date": "YYYYMMDD",  # ì‹ ê³ ê°€ ë°œìƒì¼
++        "last_down_date": "YYYYMMDD",  # 3ë²ˆì§¸ í•˜ë½ì¼
++        "reason": str               # setup=Falseì¼ ë•Œ ìŠ¤í‚µ ì‚¬ìœ 
++    }
++    """
++    try:
++        candles = _get_daily_candles_cached(
++            kis, code, count=max(lookback, pullback_days + 5)
++        )
++    except Exception as e:
++        return {"setup": False, "reason": f"daily_fetch_fail:{e}"}
++
++    if len(candles) < pullback_days + 2:
++        return {"setup": False, "reason": "not_enough_candles"}
++
++    today = datetime.now(KST).strftime("%Y%m%d")
++    completed = list(candles)
++    if completed and str(completed[-1].get("date")) == today:
++        completed = completed[:-1]
++    if len(completed) < pullback_days + 2:
++        return {"setup": False, "reason": "insufficient_history_after_trim"}
++
++    window = completed[-lookback:]
++    highs = [float(c.get("high") or 0.0) for c in window]
++    if not highs:
++        return {"setup": False, "reason": "no_high_data"}
++
++    peak_price = max(highs)
++    try:
++        peak_idx = max(
++            i for i, c in enumerate(window) if float(c.get("high") or 0.0) == peak_price
++        )
++    except Exception:
++        return {"setup": False, "reason": "peak_index_error"}
++
++    # ì§ì „ ì¼ìê¹Œì§€ ì—°ì† í•˜ë½ êµ¬ê°„ ê¸¸ì´ë¥¼ ê³„ì‚°(ì–´ì œê¹Œì§€ nì¼ ì—°ì† í•˜ë½ì¸ì§€)
++    down_streak_len = 0
++    last_idx = len(window) - 1
++    while last_idx > peak_idx:
++        try:
++            cur_close = float(window[last_idx].get("close") or 0.0)
++            prev_close = float(window[last_idx - 1].get("close") or 0.0)
++        except Exception:
++            break
++        if cur_close <= 0 or prev_close <= 0:
++            break
++        if cur_close < prev_close:
++            down_streak_len += 1
++            last_idx -= 1
++            continue
++        break
++
++    if down_streak_len < pullback_days:
++        return {
++            "setup": False,
++            "peak_price": peak_price,
++            "reason": "not_enough_consecutive_down",
++        }
++
++    if last_idx < peak_idx:
++        return {
++            "setup": False,
++            "peak_price": peak_price,
++            "reason": "down_streak_not_after_peak",
++        }
++
++    last_down = window[len(window) - 1]
++    try:
++        reversal_line = max(
++            float(last_down.get("high") or 0.0), float(last_down.get("close") or 0.0)
++        )
++    except Exception:
++        reversal_line = 0.0
++
++    reversal_price = reversal_line * (1.0 + buffer_pct / 100.0)
++    reversing = (
++        current_price is not None
++        and reversal_price > 0
++        and float(current_price) >= float(reversal_price)
++    )
++
++    return {
++        "setup": True,
++        "reversing": bool(reversing),
++        "reversal_price": float(reversal_price) if reversal_price > 0 else None,
++        "peak_price": float(peak_price),
++        "peak_date": window[peak_idx].get("date"),
++        "last_down_date": last_down.get("date"),
++    }
++
+ from .kis_wrapper import NetTemporaryError, DataEmptyError, DataShortError
+ 
+ # === [ANCHOR: INTRADAY_MOMENTUM] 1ë¶„ë´‰ VWAP + ë‹¨ê¸° ëª¨ë©˜í…€ ===
+@@ -772,10 +890,9 @@ def _maybe_scale_in_dips(
+     regime_mode: str,
+ ) -> None:
+     """
+-    ëˆŒë¦¼ëª© 3ë‹¨ê³„(40/35/25%) ì§„ì… ë¡œì§.
+-    - entry_stage: 1 â†’ 2ì°¨ ì§„ì… í›„ë³´, 2 â†’ 3ì°¨ ì§„ì… í›„ë³´, 3 â†’ ëª¨ë“  ì§„ì… ì™„ë£Œ
++    ì‹ ê³ ê°€ â†’ 3ì¼ ì—°ì† í•˜ë½ â†’ ë°˜ë“± í™•ì¸ ì‹œ ë‹¨ê³„ì  ì¶”ê°€ ë§¤ìˆ˜ ë¡œì§.
++    - entry_stage: 1 â†’ 2ì°¨ ì§„ì… í›„ë³´(ë°˜ë“± í™•ì¸ì„  ëŒíŒŒ), 2 â†’ 3ì°¨ ì§„ì… í›„ë³´(ì‹ ê³ ê°€ íšŒë³µ)
+     - bull / neutral ëª¨ë“œì—ì„œë§Œ ë™ì‘, bear ëª¨ë“œì—ì„œëŠ” ì¶”ê°€ ì§„ì… ê¸ˆì§€
+-    - max_price_after_entry ê¸°ì¤€ìœ¼ë¡œ -1.5%, -3.0% ì¡°ì • ì‹œì ì—ë§Œ ì¶”ê°€ ì§„ì…
+     """
+     pos = holding.get(code)
+     if not pos:
+@@ -823,16 +940,6 @@ def _maybe_scale_in_dips(
+             )
+             return
+ 
+-    # max_price_after_entry ì—…ë°ì´íŠ¸
+-    max_px = pos.get("max_price_after_entry") or pos.get("high") or pos.get("buy_price") or cur_price
+-    try:
+-        max_px = float(max_px)
+-    except Exception:
+-        max_px = float(cur_price)
+-    if cur_price > max_px:
+-        max_px = float(cur_price)
+-    pos["max_price_after_entry"] = float(max_px)
+-
+     # ê³„íš ìˆ˜ëŸ‰ ê³„ì‚°
+     planned_total_qty = int(
+         pos.get("planned_total_qty")
+@@ -855,23 +962,43 @@ def _maybe_scale_in_dips(
+     if current_qty <= 0:
+         return
+ 
+-    # ê³ ì  ëŒ€ë¹„ ì¡°ì •ë¥ 
+-    try:
+-        drawdown_pct = (float(cur_price) / float(max_px) - 1.0) * 100.0
+-    except Exception:
+-        drawdown_pct = 0.0
++    # ì‹ ê³ ê°€ â†’ 3ì¼ ëˆŒë¦¼ â†’ ë°˜ë“± ì—¬ë¶€ í™•ì¸
++    pullback = _detect_pullback_reversal(
++        kis=kis,
++        code=code,
++        current_price=float(cur_price),
++    )
++    if USE_PULLBACK_ENTRY and not pullback.get("setup"):
++        logger.info(
++            f"[PULLBACK-SKIP] {code}: ì‹ ê³ ê°€ ëˆŒë¦¼ íŒ¨í„´ ë¯¸ì¶©ì¡± â†’ reason={pullback.get('reason')}"
++        )
++        return
++
++    if USE_PULLBACK_ENTRY and not pullback.get("reversing"):
++        rev_px = pullback.get("reversal_price")
++        logger.info(
++            f"[PULLBACK-WAIT] {code}: í˜„ì¬ê°€({cur_price}) < ë°˜ë“±í™•ì¸ì„ ({rev_px}) â†’ ëŒ€ê¸°"
++        )
++        return
++
++    reversal_price = pullback.get("reversal_price") or float(cur_price)
++    peak_price = pullback.get("peak_price") or reversal_price
++
++    # ì°¸ê³ ìš© ìƒíƒœ ì—…ë°ì´íŠ¸
++    pos["pullback_peak_price"] = float(peak_price)
++    pos["pullback_reversal_price"] = float(reversal_price)
+ 
+     add_qty = 0
+     next_stage = entry_stage
+ 
+     if entry_stage == 1:
+-        # 2ì°¨ ì§„ì…: ê³ ì  ëŒ€ë¹„ -1.5% ì´ìƒ ì¡°ì •, ëª©í‘œ ìˆ˜ëŸ‰ s1+s2ê¹Œì§€ í™•ëŒ€
+-        if drawdown_pct <= -1.5 and current_qty < (s1 + s2):
++        # 2ì°¨ ì§„ì…: 3ì¼ ëˆŒë¦¼ í›„ ë°˜ë“± í™•ì¸ì„  ëŒíŒŒ â†’ s1+s2ê¹Œì§€ í™•ëŒ€
++        if cur_price >= reversal_price and current_qty < (s1 + s2):
+             add_qty = max(0, (s1 + s2) - current_qty)
+             next_stage = 2
+     elif entry_stage == 2:
+-        # 3ì°¨ ì§„ì…: ê³ ì  ëŒ€ë¹„ -3.0% ì´ìƒ ì¡°ì •, ì „ì²´ planned_total_qtyê¹Œì§€ í™•ëŒ€
+-        if drawdown_pct <= -3.0 and current_qty < planned_total_qty:
++        # 3ì°¨ ì§„ì…: ì‹ ê³ ê°€ íšŒë³µ(peak_price ëŒíŒŒ) ì‹œ ì „ì²´ planned_total_qtyê¹Œì§€ í™•ëŒ€
++        if cur_price >= peak_price and current_qty < planned_total_qty:
+             add_qty = max(0, planned_total_qty - current_qty)
+             next_stage = 3
+     else:
+@@ -882,7 +1009,7 @@ def _maybe_scale_in_dips(
+ 
+     logger.info(
+         f"[SCALE-IN] {code} stage={entry_stage}->{next_stage} "
+-        f"drawdown={drawdown_pct:.2f}% cur={cur_price} max={max_px} add_qty={add_qty}"
++        f"reversal_line={reversal_price:.2f} peak={peak_price:.2f} cur={cur_price} add_qty={add_qty}"
+     )
+ 
+     # ì¶”ê°€ ë§¤ìˆ˜ ì‹¤í–‰ (í˜„ì¬ê°€ ê¸°ì¤€ ê°€ë“œí˜• ì§€ì •ê°€/ì‹œì¥ê°€)
+@@ -1973,6 +2100,34 @@ def main():
+                     current_price = _safe_get_price(kis, code)
+                     logger.info(f"[ğŸ“ˆ í˜„ì¬ê°€] {code}: {current_price}")
+ 
++                    pullback_info: Dict[str, Any] = {}
++                    if USE_PULLBACK_ENTRY:
++                        pullback_info = _detect_pullback_reversal(
++                            kis=kis,
++                            code=code,
++                            current_price=float(current_price) if current_price else None,
++                        )
++                        if not pullback_info.get("setup"):
++                            logger.info(
++                                f"[PULLBACK-SKIP] {code}: ì‹ ê³ ê°€ ëˆŒë¦¼ íŒ¨í„´ ë¯¸ì¶©ì¡± â†’ reason={pullback_info.get('reason')}"
++                            )
++                            continue
++                        if not pullback_info.get("reversing"):
++                            rev_px = pullback_info.get("reversal_price")
++                            logger.info(
++                                f"[PULLBACK-WAIT] {code}: í˜„ì¬ê°€({current_price}) < ë°˜ë“±í™•ì¸ì„ ({rev_px}) â†’ ë§¤ìˆ˜ ëŒ€ê¸°"
++                            )
++                            continue
++                    else:
++                        try:
++                            pullback_info = _detect_pullback_reversal(
++                                kis=kis,
++                                code=code,
++                                current_price=float(current_price) if current_price else None,
++                            )
++                        except Exception:
++                            pullback_info = {}
++
+                     trade_common_buy = {
+                         "datetime": now_str,
+                         "code": code,
+@@ -1991,10 +2146,20 @@ def main():
+                             )
+                             continue
+ 
++                        trigger_price = eff_target_price
++                        if pullback_info.get("reversal_price"):
++                            if trigger_price is None:
++                                trigger_price = float(pullback_info.get("reversal_price"))
++                            else:
++                                trigger_price = max(
++                                    float(trigger_price),
++                                    float(pullback_info.get("reversal_price")),
++                                )
++
+                         enter_cond = (
+                             current_price is not None
+-                            and eff_target_price is not None
+-                            and int(current_price) >= int(eff_target_price)
++                            and trigger_price is not None
++                            and int(current_price) >= int(trigger_price)
+                         )
+ 
+                         if enter_cond:
+@@ -2084,6 +2249,10 @@ def main():
+                                 pos["stage1_qty"] = int(stage1_qty)
+                                 pos["stage2_qty"] = int(stage2_qty)
+                                 pos["stage3_qty"] = int(stage3_qty)
++                                if pullback_info.get("peak_price"):
++                                    pos["pullback_peak_price"] = float(pullback_info.get("peak_price"))
++                                if pullback_info.get("reversal_price"):
++                                    pos["pullback_reversal_price"] = float(pullback_info.get("reversal_price"))
+                                 holding[code] = pos
+                             except Exception as e:
+                                 logger.warning(f"[INIT-SCALEIN-STATE-FAIL] {code}: {e}")
