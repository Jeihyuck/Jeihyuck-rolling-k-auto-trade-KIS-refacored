diff --git a/.github/workflows/ci-check.yml b/.github/workflows/ci-check.yml
new file mode 100644
index 0000000000000000000000000000000000000000..40a09b3fca9061add6b455b1ca39b26e55f872ac
--- /dev/null
+++ b/.github/workflows/ci-check.yml
@@ -0,0 +1,30 @@
+name: CI Checks
+
+on:
+  push:
+  pull_request:
+
+jobs:
+  tests:
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@v4
+        with:
+          fetch-depth: 0
+
+      - uses: actions/setup-python@v5
+        with:
+          python-version: "3.11"
+
+      - name: Install dependencies
+        run: |
+          python -m pip install --upgrade pip
+          pip install -r requirements.txt
+
+      - name: Static compile check
+        run: |
+          python -m compileall portfolio strategy trader rolling_k_auto_trade_api
+
+      - name: Ledger tests
+        run: |
+          python -m trader.ledger_test
diff --git a/.github/workflows/trade-monitor.yml b/.github/workflows/trade-monitor.yml
index ed97ebe7275425f83a7b20e01e987d19a060712c..7baa7ae457964948cee9b1eff993aa54f4d03914 100644
--- a/.github/workflows/trade-monitor.yml
+++ b/.github/workflows/trade-monitor.yml
@@ -1,60 +1,54 @@
-name: Trade Monitor (trader_refactor branch)
+name: Trade Monitor (practice live only)
 
 permissions:
   contents: write
 
 concurrency:
   group: trade-bot-state
   cancel-in-progress: false
 
 on:
   schedule:
     - cron: "*/5 0-6 * * 1-5"
   workflow_dispatch:
-  push:
-    branches: [ main, trader_r1 ]
-    paths-ignore:
-      - "bot_state/**"
-  pull_request:
-    branches: [ main, trader_r1 ]
 
 jobs:
   trade-live:
     if: ${{ github.event_name == 'schedule' || github.event_name == 'workflow_dispatch' }}
     runs-on: ubuntu-latest
     env:
       # === KIS 인증키 ===
       KIS_APP_KEY: ${{ secrets.KIS_APP_KEY != '' && secrets.KIS_APP_KEY || secrets.APP_KEY }}
       KIS_APP_SECRET: ${{ secrets.KIS_APP_SECRET != '' && secrets.KIS_APP_SECRET || secrets.APP_SECRET }}
       APP_KEY: ${{ secrets.KIS_APP_KEY != '' && secrets.KIS_APP_KEY || secrets.APP_KEY }}
       APP_SECRET: ${{ secrets.KIS_APP_SECRET != '' && secrets.KIS_APP_SECRET || secrets.APP_SECRET }}
 
       CANO: ${{ secrets.CANO }}
       ACNT_PRDT_CD: ${{ secrets.ACNT_PRDT_CD }}
-      KIS_ENV: ${{ secrets.KIS_ENV }}          # practice / real
-      API_BASE_URL: ${{ secrets.API_BASE_URL }}
+      KIS_ENV: "practice"
+      API_BASE_URL: "https://openapivts.koreainvestment.com:29443"
 
       # === trader.py 운영 파라미터 ===
       PARTIAL1: "0.5"
       PARTIAL2: "0.3"
       TRAIL_PCT: "0.02"
       FAST_STOP: "0.01"
       ATR_STOP: "1.5"
 
       TIME_STOP_HHMM: "13:00"
       SELL_FORCE_TIME: "14:40"
       SELL_ALL_BALANCES_AT_CUTOFF: "0"
       FORCE_SELL_PASSES_CUTOFF: "2"
       FORCE_SELL_PASSES_CLOSE: "4"
 
       DEFAULT_PROFIT_PCT: "3.0"
       DEFAULT_LOSS_PCT: "5.0"
 
       SLIPPAGE_LIMIT_PCT: "0.25"
       SLIPPAGE_ENTER_GUARD_PCT: "2.5"
 
       VWAP_TOL: "0.003"
 
       W_MAX_ONE: "0.25"
       W_MIN_ONE: "0.03"
 
@@ -69,137 +63,129 @@ jobs:
       REG_BULL_MIN_UP_PCT: "0.5"
       REG_BULL_MIN_MINUTES: "10"
       REG_BEAR_VWAP_MINUTES: "10"
       REG_BEAR_DROP_FROM_HIGH: "0.7"
       REG_BEAR_STAGE1_MINUTES: "20"
       REG_BEAR_STAGE2_ADD_DROP: "0.5"
 
       REG_PARTIAL_S1: "0.30"
       REG_PARTIAL_S2: "0.30"
 
       TRAIL_PCT_BULL: "0.025"
       TRAIL_PCT_BEAR: "0.012"
       TP_PROFIT_PCT_BULL: "3.5"
 
       MARKET_DATA_WHEN_CLOSED: "0"
 
       DIAGNOSTIC_ONLY: "0"
       DIAGNOSTIC_FORCE_RUN: "0"
       DIAGNOSTIC_ENABLED: "0"
 
       # ===== LIVE 강제 =====
       DRY_RUN: "0"
       DISABLE_LIVE_TRADING: "0"
       LIVE_TRADING_ENABLED: "1"
       EXPECT_LIVE_TRADING: "1"
+      EXPECT_KIS_ENV: "practice"
       STRATEGY_MODE: "LIVE"
 
       # 전략 1만
       ACTIVE_STRATEGIES: "1"
 
       # 엔진 ON/OFF
       DISABLE_KOSDAQ_LOOP: "0"
       DISABLE_KOSPI_ENGINE: "1"
 
       # 안전: 장외 금지
       ALLOW_AFTER_HOURS: "0"
       ALLOW_ADOPT_UNMANAGED: "0"
 
       # 배분/속도
       DAILY_CAPITAL: "250000000"
       API_RATE_SLEEP_SEC: "0.3"
 
       # === VWAP 분봉 TR ===
       KIS_TR_ID_INTRADAY_CHART: "FHKST03010200"
       KIS_TR_ID_INTRADAY_CHART_REAL: "FHKST03010200"
 
       # === FastAPI 리밸런싱 서버(선정 필터) ===
       MIN_TRADES: "5"
       MAX_MDD_PCT: "30"
       MIN_WINRATE: "50"
       MIN_CUMRET: "2"
       TOP_K_LIMIT: "20"
       TOTAL_CAPITAL: "10000000"
       MIN_QTY_PER_TICKET: "1"
       K_MIN: "0.1"
       K_MAX: "0.9"
       K_STEP: "0.1"
       REBALANCE_OUT_DIR: "rebalance_results"
 
     steps:
       - uses: actions/checkout@v4
         with:
           fetch-depth: 0
           persist-credentials: true
+          ref: trader_r1
           token: ${{ secrets.GITHUB_TOKEN }}
 
       - name: Restore state cache (fallback only)
         uses: actions/cache/restore@v4
         with:
           path: |
             bot_state/state.json
             trader/state/state.json
           key: trader-state-${{ github.ref_name }}
           restore-keys: |
             trader-state-${{ github.ref_name }}-
 
       - name: Set git identity
         run: |
           git config user.name "trade-bot"
           git config user.email "trade-bot@users.noreply.github.com"
 
       - uses: actions/setup-python@v5
         with:
           python-version: "3.11"
 
       - name: Ensure state scripts executable
         run: |
           chmod +x scripts/state_pull_plain.sh scripts/state_push_plain.sh || true
 
       - name: Pull state (plain)
         run: |
           bash scripts/state_pull_plain.sh
 
       - name: Dependencies 설치
         run: |
           python -m pip install --upgrade pip
           pip install -r requirements.txt
 
       - name: Ledger smoke test
         run: |
           python -m trader.ledger_test
 
-      - name: (LIVE 체크) 핵심 env 값 출력
-        run: |
-          echo "GITHUB_EVENT_NAME=$GITHUB_EVENT_NAME"
-          python - << 'PY'
-          import os
-          keys = ["DRY_RUN","DISABLE_LIVE_TRADING","LIVE_TRADING_ENABLED","EXPECT_LIVE_TRADING","STRATEGY_MODE","KIS_ENV"]
-          for k in keys:
-              print(k, "=", os.getenv(k))
-          PY
-
       - name: 리밸런싱 API 서버 실행 (FastAPI, 백그라운드, 로그파일)
         run: |
           nohup uvicorn rolling_k_auto_trade_api.main:app --host 0.0.0.0 --port 8000 > fastapi.log 2>&1 &
           sleep 30
 
       - name: Compile modules
         run: |
           python -m compileall trader rolling_k_auto_trade_api
 
       - name: trader LIVE (strategy1 only)
         env:
           PYTHONPATH: ${{ github.workspace }}
         run: |
           python -m trader.trader
 
       - name: Normalize state path
         if: always()
         run: |
           mkdir -p trader/state
           test -f .runtime/state.json && cp -f .runtime/state.json trader/state/state.json || true
           test -f trader/state/state.json && echo "[STATE] trader/state/state.json exists" || echo "[STATE] missing!"
 
       - name: CEO 리포트 자동 생성
         if: always()
         env:
@@ -235,85 +221,25 @@ jobs:
 
       - name: Trades 로그 업로드
         if: always()
         uses: actions/upload-artifact@v4
         with:
           name: trade-logs
           path: trader/logs/*.json
           if-no-files-found: ignore
           retention-days: 14
 
       - name: FastAPI 로그 출력 (cat)
         if: always()
         run: |
           echo "::group::FastAPI Server Log"
           cat fastapi.log || true
           echo "::endgroup::"
 
       - name: FastAPI 로그 업로드 (artifact)
         if: always()
         uses: actions/upload-artifact@v4
         with:
           name: fastapi-log
           path: fastapi.log
           if-no-files-found: ignore
           retention-days: 14
-
-  trade-diag:
-    if: ${{ github.event_name == 'push' || github.event_name == 'pull_request' }}
-    runs-on: ubuntu-latest
-    env:
-      KIS_APP_KEY: ${{ secrets.KIS_APP_KEY != '' && secrets.KIS_APP_KEY || secrets.APP_KEY }}
-      KIS_APP_SECRET: ${{ secrets.KIS_APP_SECRET != '' && secrets.KIS_APP_SECRET || secrets.APP_SECRET }}
-      APP_KEY: ${{ secrets.KIS_APP_KEY != '' && secrets.KIS_APP_KEY || secrets.APP_KEY }}
-      APP_SECRET: ${{ secrets.KIS_APP_SECRET != '' && secrets.KIS_APP_SECRET || secrets.APP_SECRET }}
-
-      CANO: ${{ secrets.CANO }}
-      ACNT_PRDT_CD: ${{ secrets.ACNT_PRDT_CD }}
-      KIS_ENV: ${{ secrets.KIS_ENV }}
-      API_BASE_URL: ${{ secrets.API_BASE_URL }}
-
-      # ===== DIAG 강제 =====
-      DRY_RUN: "1"
-      DISABLE_LIVE_TRADING: "1"
-      LIVE_TRADING_ENABLED: "0"
-      EXPECT_LIVE_TRADING: "0"
-      STRATEGY_MODE: "INTENT_ONLY"
-
-      ACTIVE_STRATEGIES: "1"
-      DISABLE_KOSDAQ_LOOP: "1"
-      DISABLE_KOSPI_ENGINE: "1"
-
-      DAILY_CAPITAL: "250000000"
-      API_RATE_SLEEP_SEC: "0.3"
-
-    steps:
-      - uses: actions/checkout@v4
-        with:
-          fetch-depth: 0
-          persist-credentials: true
-          token: ${{ secrets.GITHUB_TOKEN }}
-
-      - uses: actions/setup-python@v5
-        with:
-          python-version: "3.11"
-
-      - name: Dependencies 설치
-        run: |
-          python -m pip install --upgrade pip
-          pip install -r requirements.txt
-
-      - name: Ledger smoke test
-        run: |
-          python -m trader.ledger_test
-
-      - name: Compile modules
-        run: |
-          python -m compileall trader rolling_k_auto_trade_api
-
-      - name: trader DIAG (no live orders)
-        env:
-          PYTHONPATH: ${{ github.workspace }}
-        run: |
-          python -m trader.trader
-
-   
\ No newline at end of file
diff --git a/settings.py b/settings.py
index 828f2d5ae4359f76fa2b0dfc62305b8d4a4f0b5d..44fd3b7b8d083e40b0014c9fdcefa8ef68c7a6d1 100644
--- a/settings.py
+++ b/settings.py
@@ -1,39 +1,40 @@
 # settings.py (전체 통합형 예시: 실전 전략 + API + 환경옵션 한눈에 관리)
 import os
 import logging
 
-SLACK_WEBHOOK = os.getenv("SLACK_WEBHOOK", "")
-
 def safe_strip(val):
     """모든 입력값에서 개행, 캐리지리턴, 양쪽 공백 제거."""
     if val is None:
         return ''
     if isinstance(val, str):
         return val.replace('\n', '').replace('\r', '').strip()
     return str(val).strip()
 
+
+SLACK_WEBHOOK = safe_strip(os.getenv("SLACK_WEBHOOK", ""))
+
 # === API/계정/실전 환경 ===
 APP_KEY        = safe_strip(os.getenv("KIS_APP_KEY"))
 APP_SECRET     = safe_strip(os.getenv("KIS_APP_SECRET"))
 CANO           = safe_strip(os.getenv("CANO"))
 ACNT_PRDT_CD   = safe_strip(os.getenv("ACNT_PRDT_CD"))
 KIS_ENV        = safe_strip(os.getenv("KIS_ENV", "practice"))
 
 if KIS_ENV == "real":
     API_BASE_URL = "https://openapi.koreainvestment.com:9443"
 else:
     API_BASE_URL = "https://openapivts.koreainvestment.com:29443"
 
 KIS_ACCOUNT    = safe_strip(os.getenv("KIS_ACCOUNT", ""))
 KIS_REST_URL   = safe_strip(os.getenv("KIS_REST_URL", ""))
 KIS_WS_URL     = safe_strip(os.getenv("KIS_WS_URL", ""))
 
 # === 실전 전략/실험 환경 변수 ===
 #REBALANCE_ANCHOR      = os.getenv("REBALANCE_ANCHOR", "first")
 REBALANCE_ANCHOR="weekly"
 
 DAILY_CAPITAL         = int(os.getenv("DAILY_CAPITAL", "250000000"))
 SLIPPAGE_LIMIT_PCT    = float(os.getenv("SLIPPAGE_LIMIT_PCT", "0.25"))
 PARTIAL1              = float(os.getenv("PARTIAL1", "0.5"))
 PARTIAL2              = float(os.getenv("PARTIAL2", "0.3"))
 TRAIL_PCT             = float(os.getenv("TRAIL_PCT", "0.02"))
diff --git a/trader/trader.py b/trader/trader.py
index b36d723971edb5e01d649d32ebc80e8f42881f8d..12bb13daa61750dcd28fca391482b29e43585a82 100644
--- a/trader/trader.py
+++ b/trader/trader.py
@@ -42,50 +42,74 @@ def main() -> None:
     if disable_live_flag.value:
         dry_run_reasons.append("DISABLE_LIVE_TRADING=1")
     if diag_enabled:
         dry_run_reasons.append("diagnostic_mode")
     if not live_trading_flag.value and mode == "LIVE":
         dry_run_reasons.append("LIVE_TRADING_ENABLED=0")
     if dry_run_flag.value:
         dry_run_reasons.append("DRY_RUN=1")
     if event_name_lower in {"push", "pull_request"} and mode == "LIVE":
         dry_run_reasons.append(f"event={event_name_lower}")
     for flag in (dry_run_flag, disable_live_flag, live_trading_flag):
         if not flag.valid:
             dry_run_reasons.append(f"{flag.name}=invalid({flag.raw})")
 
     dry_run = bool(dry_run_reasons)
     dry_run_reason = ",".join(dry_run_reasons) if dry_run_reasons else "live"
     live_trading_enabled = bool(
         mode == "LIVE" and live_trading_flag.value and not disable_live_flag.value and not dry_run
     )
     engine_disabled_reason = dry_run_reason if dry_run else (
         "DISABLE_LIVE_TRADING env=true" if disable_live_flag.value else (
             "LIVE_TRADING_ENABLED env=false" if not live_trading_flag.value else "enabled"
         )
     )
 
+    expect_kis_env = os.getenv("EXPECT_KIS_ENV")
+    kis_env = (os.getenv("KIS_ENV") or "").strip()
+    api_base_url = (os.getenv("API_BASE_URL") or "").lower()
+    if expect_live_flag:
+        snapshot = {
+            "DRY_RUN": dry_run_flag.raw if dry_run_flag.raw is not None else dry_run_flag.value,
+            "DISABLE_LIVE_TRADING": disable_live_flag.raw if disable_live_flag.raw is not None else disable_live_flag.value,
+            "LIVE_TRADING_ENABLED": live_trading_flag.raw if live_trading_flag.raw is not None else live_trading_flag.value,
+            "STRATEGY_MODE": mode,
+            "EXPECT_KIS_ENV": expect_kis_env,
+            "KIS_ENV": kis_env,
+            "API_BASE_URL": api_base_url,
+            "event": event_name_lower or "unknown",
+        }
+        if dry_run or disable_live_flag.value or (not live_trading_flag.value) or mode != "LIVE":
+            logger.error("[TRADER][GUARD] EXPECT_LIVE_TRADING=1 but live flags invalid: %s", snapshot)
+            raise SystemExit(2)
+        if expect_kis_env and kis_env != expect_kis_env:
+            logger.error("[TRADER][GUARD] EXPECT_KIS_ENV mismatch: %s", snapshot)
+            raise SystemExit(2)
+        if kis_env == "practice" and "openapivts" not in api_base_url:
+            logger.error("[TRADER][GUARD] practice env requires openapivts endpoint: %s", snapshot)
+            raise SystemExit(2)
+
     os.environ["DRY_RUN"] = "1" if dry_run else "0"
     os.environ["DISABLE_LIVE_TRADING"] = "1" if (dry_run or disable_live_flag.value) else "0"
     os.environ["LIVE_TRADING_ENABLED"] = "1" if live_trading_flag.value else "0"
     os.environ["STRATEGY_MODE"] = mode
 
     if expect_live_flag and dry_run:
         resolved_values = (
             f"DRY_RUN={dry_run_flag.raw!r} DISABLE_LIVE_TRADING={disable_live_flag.raw!r} "
             f"LIVE_TRADING_ENABLED={live_trading_flag.raw!r} mode={mode} event={event_name_lower or 'unknown'}"
         )
         raise SystemExit(
             f"EXPECT_LIVE_TRADING=1 but dry_run resolved True. reasons={dry_run_reasons} values={resolved_values}"
         )
     logger.info(
         "[DIAG][TRADER] now=%s trading_day=%s diag_enabled=%s force_run=%s only=%s mode=%s",
         now.isoformat(),
         trading_day,
         DIAG_ENABLED,
         DIAGNOSTIC_FORCE_RUN,
         DIAGNOSTIC_ONLY,
         DIAGNOSTIC_MODE,
     )
     logger.info(
         "[TRADER][STARTUP] event=%s trading_day=%s mode=%s dry_run=%s reasons=%s live_trading_enabled=%s disable_live_flag=%s dry_run_flag=%s live_trading_flag=%s active_strategies=%s allow_adopt_unmanaged=%s engine_disabled_reason=%s",
         event_name or "unknown",
diff --git a/trader/utils/__init__.py b/trader/utils/__init__.py
index eb2f2b69ab0867992dfca1f2efce4c2b08be9db5..407f41862501eee10587be936cf2561b9d6b45be 100644
--- a/trader/utils/__init__.py
+++ b/trader/utils/__init__.py
@@ -1,29 +1,32 @@
 import logging
 import requests
 
-from settings import SLACK_WEBHOOK
+try:
+    from settings import SLACK_WEBHOOK
+except Exception:
+    SLACK_WEBHOOK = ""
 from .env import (
     EnvFlag,
     FALSE_VALUES,
     TRUE_VALUES,
     env_bool,
     env_str,
     parse_env_flag,
     resolve_mode,
 )
 
 logging.basicConfig(level=logging.INFO, format="%(asctime)s %(message)s")
 
 
 def log(msg):
     logging.info(msg)
 
 
 def send_slack(text):
     if not SLACK_WEBHOOK:
         return
     requests.post(SLACK_WEBHOOK, json={"text": text})
 
 
 __all__ = [
     "EnvFlag",
